<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Fire Pixel</title>
<script>
// 从 URL 获取参数
const q = new URLSearchParams(location.search);
const pids = (q.get('pid') || '').split(','); // 支持多个Pixel ID,逗号分隔
const eventName = q.get('e') || 'Purchase';
const value = parseFloat(q.get('v') || '99');
const currency = (q.get('cur') || 'BRL').toUpperCase();
const redirect = q.get('redirect'); // 可选跳转

// 加载 Pixel 脚本
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){
n.callMethod? n.callMethod.apply(n,arguments) : n.queue.push(arguments)};
if(!f._fbq)f._fbq=n; n.push=n; n.loaded=!0; n.version='2.0';
n.queue=[]; t=b.createElement(e); t.async=!0;
t.src=v; s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');

// 对每个 Pixel ID 初始化并发送事件
pids.forEach(pid => {
    if (pid.trim()) {
        fbq('init', pid.trim());
        fbq('track', eventName, { value: value, currency: currency });
        console.log(`Pixel ${pid.trim()} triggered: ${eventName}`);
    }
});

// 延迟跳转（可选）
if (redirect) {
    setTimeout(() => { location.href = redirect; }, 800);
}
</script>
</head>
<body>
<p>Firing Pixel(s)...</p>
</body>
</html>
